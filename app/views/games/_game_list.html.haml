- bracket_names = %w(Winners Losers Final)
%h2 #{bracket_names[bracket-1]} Bracket
- case bracket
- when 1
  - round_num = tournament.round_num
- when 2
  - round_num = tournament.loser_round_num
- when 3
  - round_num = 1

- round_num.downto(1) do |i|
  - if bracket == 3
    - panel = 'panel-danger'
  - else
    - panel = (i==round_num) ? "panel-warning" : "panel-default"
  .panel{class: panel}
    .panel-heading= tournament.round_name(bracket:bracket, round:i)
    %table#game-list.table.f16
      - tournament.games.where(bracket:bracket, round: i).each do |game|
        - unless (!tournament.consolation_round) && (i==tournament.round_num && game.match==2)
          %tr
            %td.width-10= game.match_name

            -# First Player
            - if game.ready?
              - if game.finished?
                - text_color =(game.winner == game.game_records.first.player) ? 'text-danger' : 'text-muted'
              - else
                - text_color = ''
              %td.width-30.text-right{class: text_color}
                %div.flag-container
                  - if game.game_records.first.player.country.present?
                    - country = game.game_records.first.player.country.downcase
                    %div.flag{class: country}
                = game.game_records.first.player.name
              %td.width-8.text-right
                - if game.finished? && !game.bye && !tournament.scoreless?
                  #{game.game_records.first.score}

              %td.width-4.text-center -

              -# Second Player
              %td.width-8
                - if game.finished? && !game.bye && !tournament.scoreless?
                  #{game.game_records.second.score}
              - if game.finished?
                - text_color =(game.winner == game.game_records.second.player) ? 'text-danger' : 'text-muted'
              - else
                - text_color = ''
              %td.width-30{class: text_color}
                %div.flag-container
                  - if game.game_records.second.player.country.present?
                    - country = game.game_records.second.player.country.downcase
                    %div.flag{class: country}
                = game.game_records.second.player.name
            - else
              %td.width-30.text-right (TBD)
              %td.width-8
              %td.width-4.text-center -
              %td.width-8
              %td.width-30 (TBD)
            %td.width-10.text-right
              - if editable && game.ready? && !game.bye
                = link_to t('edit'), edit_game_path(game), class: 'btn btn-primary btn-sm pull-right'
